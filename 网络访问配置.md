# WhisperLiveKit 网络访问配置说明

## ✅ 已配置为对所有 IP 开放访问

### 配置详情

#### 1. Docker 端口映射
**文件**: `docker-compose.yml`
```yaml
ports:
  - "0.0.0.0:${WLK_PORT:-8000}:8000"
```
- ✅ 明确绑定到 `0.0.0.0`
- ✅ 可从任意 IP 访问

#### 2. 应用服务器配置
**文件**: `start_with_gpu_selection.py`
```python
cmd = [
    'python3', '-m', 'whisperlivekit.enhanced_server',
    '--host', '0.0.0.0',  # 监听所有网络接口
    '--port', '8000',
    ...
]
```
- ✅ FastAPI 监听 `0.0.0.0`
- ✅ 接受所有来源的连接

#### 3. CORS 配置
**文件**: `whisperlivekit/enhanced_server.py`
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 允许所有来源
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```
- ✅ 允许跨域访问
- ✅ 支持所有 HTTP 方法

## 🌐 访问方式

### 本机访问
```bash
http://localhost:8000
```

### 局域网访问
```bash
http://服务器IP:8000
```

### 公网访问（需配置防火墙）
```bash
http://公网IP:8000
```

## 🔍 验证访问

### 方法一：运行测试脚本
```bash
./test_network_access.sh
```

### 方法二：手动测试
```bash
# 测试健康检查
curl http://localhost:8000/health
curl http://服务器IP:8000/health

# 查看端口监听
netstat -tuln | grep 8000
# 或
ss -tuln | grep 8000

# 查看 Docker 端口映射
docker port whisperlivekit
```

### 预期输出
```
8000/tcp -> 0.0.0.0:8000
```

## 🔒 安全建议

### 生产环境
如果部署在公网，建议：

1. **使用防火墙限制访问**
```bash
# 只允许特定 IP 访问
sudo ufw allow from 特定IP to any port 8000
```

2. **使用 Nginx 反向代理**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

3. **启用 HTTPS**
```bash
# 在 .env 中配置
WLK_SSL_CERTFILE=/path/to/cert.pem
WLK_SSL_KEYFILE=/path/to/key.pem
```

4. **添加认证**
考虑在 Nginx 层添加 Basic Auth 或使用 OAuth2

### 内网环境
如果只在内网使用，当前配置已足够安全。

## 🧪 测试清单

- [ ] 本机访问 `http://localhost:8000` 正常
- [ ] 局域网访问 `http://服务器IP:8000` 正常
- [ ] API 文档 `http://服务器IP:8000/docs` 可访问
- [ ] WebSocket 连接正常
- [ ] 跨域请求正常

## 📝 常见问题

### Q: 无法从其他机器访问？
A: 检查：
1. 防火墙是否开放 8000 端口
2. Docker 容器是否正常运行
3. 服务器 IP 是否正确

### Q: 如何开放防火墙端口？
A: 
```bash
# Ubuntu/Debian
sudo ufw allow 8000

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload
```

### Q: 如何限制访问来源？
A: 修改 `docker-compose.yml`：
```yaml
ports:
  - "特定IP:8000:8000"  # 只允许特定 IP
```

## ✅ 配置验证

当前配置确保：
- ✅ Docker 绑定到 `0.0.0.0:8000`
- ✅ FastAPI 监听 `0.0.0.0:8000`
- ✅ CORS 允许所有来源
- ✅ 可从任意 IP 访问

**配置已完成，可从任意 IP 访问！** 🎉
